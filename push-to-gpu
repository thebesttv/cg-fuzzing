#!/usr/bin/env bash

# è®¾ç½®ç›®æ ‡ä¸»æœºå
TARGET_HOST="nju-pc"

# å°è¯•è·å–ä¸»æœºå
# ä¼˜å…ˆä½¿ç”¨ uname -nï¼Œå¦‚æœæ²¡æœ‰åˆ™å°è¯•è¯»å–ç¯å¢ƒå˜é‡ HOSTNAMEï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰åˆ™è¯»å– /etc/hostname
if command -v uname >/dev/null 2>&1; then
    CURRENT_HOST=$(uname -n)
else
    # å¤‡é€‰æ–¹æ¡ˆï¼šç›´æ¥ä½¿ç”¨ç¯å¢ƒå˜é‡ (Bash ç‰¹æœ‰) æˆ–è€…è¯»å–æ–‡ä»¶
    CURRENT_HOST="${HOSTNAME:-$(cat /etc/hostname 2>/dev/null)}"
fi

# å»é™¤å¯èƒ½å­˜åœ¨çš„ç©ºç™½å­—ç¬¦
CURRENT_HOST=$(echo "$CURRENT_HOST" | xargs)

if [[ "$CURRENT_HOST" == "$TARGET_HOST" ]]; then
    echo "âœ… [Check Passed] Current host: $CURRENT_HOST"

    echo "----------------------------------------"
    echo "ğŸš€ Pushing to amax..."
    GIT_LFS_SKIP_PUSH=1 git push amax main --force

    echo "----------------------------------------"
    echo "ğŸš€ Pushing to bmax..."
    GIT_LFS_SKIP_PUSH=1 git push bmax main --force

    echo "----------------------------------------"
    echo "ğŸ‰ Done."
else
    echo "âš ï¸  [Check Failed] Current host is '$CURRENT_HOST', but expected '$TARGET_HOST'."
    echo "ğŸš« Push skipped."
fi
